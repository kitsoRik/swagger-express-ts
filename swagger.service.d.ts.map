{"version":3,"sources":["../../lib/swagger-express-ts-lib/src/swagger.service.ts"],"names":[],"mappings":"AAEA,OAAO,EAAE,aAAa,EAAE,MAAM,GAAG,CAAC;AAClC,OAAO,EAAE,qBAAqB,EAAE,MAAM,gCAAgC,CAAC;AACvE,OAAO,EAAE,oBAAoB,EAAE,MAAM,+BAA+B,CAAC;AACrE,OAAO,EAAE,qBAAqB,EAAE,MAAM,gCAAgC,CAAC;AACvE,OAAO,EAAE,YAAY,EAAE,MAAM,sBAAsB,CAAC;AACpD,OAAO,EAIH,6BAA6B,EAChC,MAAM,6BAA6B,CAAC;AACrC,OAAO,EACH,QAAQ,EAIR,oBAAoB,EACpB,YAAY,EASf,MAAM,aAAa,CAAC;AAErB,OAAO,EACH,4BAA4B,EAE5B,0BAA0B,EAC7B,MAAM,mBAAmB,CAAC;AAoB3B,qBAAa,cAAc;WACT,WAAW,IAAI,cAAc;IAQ3C,OAAO,CAAC,MAAM,CAAC,QAAQ,CAAiB;IACxC,OAAO,CAAC,aAAa,CAAsC;IAC3D,OAAO,CAAC,IAAI,CAAW;IACvB,OAAO,CAAC,SAAS,CAAuD;IACxE,OAAO,CAAC,eAAe,CAAmD;IAEnE,SAAS,IAAI,IAAI;IAKjB,OAAO,IAAI,QAAQ;IAInB,WAAW,CAAC,QAAQ,EAAE,MAAM,GAAG,IAAI;IAInC,UAAU,CAAC,OAAO,EAAE,MAAM,GAAG,IAAI;IAIjC,OAAO,CAAC,IAAI,EAAE,YAAY,GAAG,IAAI;IAIjC,UAAU,CAAC,OAAO,EAAE,MAAM,EAAE,GAAG,IAAI;IAInC,WAAW,CAAC,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI;IAIrC,WAAW,CAAC,QAAQ,EAAE,MAAM,EAAE,GAAG,IAAI;IAIrC,OAAO,CAAC,IAAI,EAAE,MAAM,GAAG,IAAI;IAI3B,cAAc,CAAC,MAAM,EAAE;QAC1B,CAAC,GAAG,EAAE,MAAM,GAAG,4BAA4B,CAAC;KAC/C,GAAG,IAAI;IAmDD,eAAe,CAAC,YAAY,EAAE,oBAAoB,GAAG,IAAI;IAIzD,kBAAkB,CAAC,eAAe,EAAE;QACvC,CAAC,GAAG,EAAE,MAAM,GAAG,6BAA6B,CAAC;KAChD,GAAG,IAAI;IAID,OAAO,CAAC,IAAI,EAAE,YAAY,EAAE,MAAM,EAAE,GAAG,GAAG,IAAI;IAuB9C,eAAe,CAClB,IAAI,EAAE,oBAAoB,EAC1B,MAAM,EAAE,GAAG,EACX,WAAW,EAAE,MAAM,GAAG,MAAM,GAC7B,IAAI;IASA,gBAAgB,CACnB,IAAI,EAAE,qBAAqB,EAC3B,MAAM,EAAE,GAAG,EACX,WAAW,EAAE,MAAM,GAAG,MAAM,GAC7B,IAAI;IAOA,eAAe,CAClB,IAAI,EAAE,qBAAqB,EAC3B,MAAM,EAAE,GAAG,EACX,WAAW,EAAE,MAAM,GAAG,MAAM,GAC7B,IAAI;IAOA,iBAAiB,CACpB,IAAI,EAAE,qBAAqB,EAC3B,MAAM,EAAE,GAAG,EACX,WAAW,EAAE,MAAM,GAAG,MAAM,GAC7B,IAAI;IAOA,kBAAkB,CACrB,IAAI,EAAE,qBAAqB,EAC3B,MAAM,EAAE,GAAG,EACX,WAAW,EAAE,MAAM,GAAG,MAAM,GAC7B,IAAI;IAQA,sBAAsB,CAAC,mBAAmB,EAAE;QAC/C,CAAC,GAAG,EAAE,MAAM,GAAG,0BAA0B,CAAC;KAC7C,GAAG,IAAI;IAID,YAAY,IAAI,IAAI;IA6DpB,mBAAmB,CACtB,IAAI,EAAE,qBAAqB,EAC3B,MAAM,EAAE,GAAG,EACX,WAAW,EAAE,MAAM,GAAG,MAAM,EAC5B,YAAY,EAAE,MAAM;IAsCjB,WAAW,CAAC,IAAI,EAAE,aAAa,EAAE,MAAM,EAAE,GAAG,GAAG,GAAG;IA0BzD,OAAO,CAAC,QAAQ;IAiBhB,OAAO,CAAC,YAAY;IAqDpB,OAAO,CAAC,cAAc;IAwFtB,OAAO,CAAC,uBAAuB;IAmG/B,OAAO,CAAC,2BAA2B;IAgEnC,OAAO,CAAC,sBAAsB;IAa9B,OAAO,CAAC,eAAe;IA+BvB,OAAO,CAAC,qBAAqB;IAgC7B,OAAO,CAAC,QAAQ;CAGnB","file":"swagger.service.d.ts","sourcesContent":["import * as assert from 'assert';\r\nimport * as _ from 'lodash';\r\nimport { IApiModelArgs } from '.';\r\nimport { IApiModelPropertyArgs } from './api-model-property.decorator';\r\nimport { IApiOperationGetArgs } from './api-operation-get.decorator';\r\nimport { IApiOperationPostArgs } from './api-operation-post.decorator';\r\nimport { IApiPathArgs } from './api-path.decorator';\r\nimport {\r\n    IApiBodyOperationArgsBaseParameter,\r\n    IApiOperationArgsBase,\r\n    IApiOperationArgsBaseParameter,\r\n    IApiOperationArgsBaseResponse,\r\n} from './i-api-operation-args.base';\r\nimport {\r\n    ISwagger,\r\n    ISwaggerDefinition,\r\n    ISwaggerDefinitionProperty,\r\n    ISwaggerDefinitionPropertyItems,\r\n    ISwaggerExternalDocs,\r\n    ISwaggerInfo,\r\n    ISwaggerOperation,\r\n    ISwaggerOperationParameter,\r\n    ISwaggerOperationResponse,\r\n    ISwaggerOperationSchema,\r\n    ISwaggerOperationSchemaItems,\r\n    ISwaggerPath,\r\n    ISwaggerPropertySchemaOperation,\r\n    ISwaggerTag,\r\n} from './i-swagger';\r\nimport { SwaggerDefinitionConstant } from './swagger-definition.constant';\r\nimport {\r\n    ISwaggerBuildDefinitionModel,\r\n    ISwaggerBuildDefinitionModelProperty,\r\n    ISwaggerSecurityDefinition,\r\n} from './swagger.builder';\r\n\r\ninterface IPath {\r\n    path: string;\r\n    get?: ISwaggerOperation;\r\n    post?: ISwaggerOperation;\r\n    put?: ISwaggerOperation;\r\n    patch?: ISwaggerOperation;\r\n    delete?: ISwaggerOperation;\r\n}\r\n\r\ninterface IController {\r\n    path?: string;\r\n    paths?: { [key: string]: IPath };\r\n    name?: string;\r\n    description?: string;\r\n    security?: { [key: string]: any[] };\r\n    deprecated?: boolean;\r\n}\r\n\r\nexport class SwaggerService {\r\n    public static getInstance(): SwaggerService {\r\n        if (!SwaggerService.instance) {\r\n            const newSwaggerService: SwaggerService = new SwaggerService();\r\n            newSwaggerService.initData();\r\n            SwaggerService.instance = newSwaggerService;\r\n        }\r\n        return SwaggerService.instance;\r\n    }\r\n    private static instance: SwaggerService;\r\n    private controllerMap: { [key: string]: IController } = {};\r\n    private data: ISwagger;\r\n    private modelsMap: { [key: string]: ISwaggerBuildDefinitionModel } = {};\r\n    private globalResponses: { [key: string]: IApiOperationArgsBaseResponse };\r\n\r\n    public resetData(): void {\r\n        this.controllerMap = {};\r\n        this.initData();\r\n    }\r\n\r\n    public getData(): ISwagger {\r\n        return _.cloneDeep(this.data);\r\n    }\r\n\r\n    public setBasePath(basePath: string): void {\r\n        this.data.basePath = basePath;\r\n    }\r\n\r\n    public setOpenapi(openapi: string): void {\r\n        this.data.openapi = openapi;\r\n    }\r\n\r\n    public setInfo(info: ISwaggerInfo): void {\r\n        this.data.info = info;\r\n    }\r\n\r\n    public setSchemes(schemes: string[]): void {\r\n        this.data.schemes = schemes;\r\n    }\r\n\r\n    public setProduces(produces: string[]): void {\r\n        this.data.produces = produces;\r\n    }\r\n\r\n    public setConsumes(consumes: string[]): void {\r\n        this.data.consumes = consumes;\r\n    }\r\n\r\n    public setHost(host: string): void {\r\n        this.data.host = host;\r\n    }\r\n\r\n    public setDefinitions(models: {\r\n        [key: string]: ISwaggerBuildDefinitionModel;\r\n    }): void {\r\n        const definitions: { [key: string]: ISwaggerDefinition } = {};\r\n        for (const modelIndex in models) {\r\n            const model: ISwaggerBuildDefinitionModel = models[modelIndex];\r\n            const newDefinition: ISwaggerDefinition = {\r\n                type: SwaggerDefinitionConstant.Model.Type.OBJECT,\r\n                properties: {},\r\n                required: [],\r\n            };\r\n            if (model.description) {\r\n                newDefinition.description = model.description;\r\n            }\r\n            for (const propertyIndex in model.properties) {\r\n                const property: ISwaggerBuildDefinitionModelProperty =\r\n                    model.properties[propertyIndex];\r\n                const newProperty: ISwaggerDefinitionProperty = {\r\n                    type: property.type,\r\n                };\r\n                newProperty.format = property.format;\r\n                newProperty.description = property.description;\r\n                newProperty.enum = property.enum;\r\n                newProperty.example = property.example;\r\n                if (property.itemType) {\r\n                    newProperty.items = {\r\n                        type: property.itemType,\r\n                    } as ISwaggerDefinitionPropertyItems;\r\n                }\r\n                if (property.model) {\r\n                    if (\r\n                        _.isEqual(\r\n                            SwaggerDefinitionConstant.Model.Property.Type.ARRAY,\r\n                            property.type\r\n                        )\r\n                    ) {\r\n                        newProperty.items = {\r\n                            $ref: this.buildRef(property.model),\r\n                        } as ISwaggerDefinitionPropertyItems;\r\n                    } else {\r\n                        newProperty.$ref = this.buildRef(property.model);\r\n                    }\r\n                }\r\n                if (property.required) {\r\n                    newDefinition.required.push(propertyIndex);\r\n                }\r\n                newDefinition.properties[propertyIndex] = newProperty;\r\n            }\r\n            definitions[modelIndex] = newDefinition;\r\n        }\r\n        this.data.definitions = _.mergeWith(this.data.definitions, definitions);\r\n    }\r\n\r\n    public setExternalDocs(externalDocs: ISwaggerExternalDocs): void {\r\n        this.data.externalDocs = externalDocs;\r\n    }\r\n\r\n    public setGlobalResponses(globalResponses: {\r\n        [key: string]: IApiOperationArgsBaseResponse;\r\n    }): void {\r\n        this.globalResponses = this.buildOperationResponses(globalResponses);\r\n    }\r\n\r\n    public addPath(args: IApiPathArgs, target: any): void {\r\n        let currentController: IController = {\r\n            path: args.path,\r\n            name: args.name,\r\n            paths: {},\r\n        };\r\n        for (const controllerIndex in this.controllerMap) {\r\n            const controller: IController = this.controllerMap[controllerIndex];\r\n            if (controllerIndex === target.name) {\r\n                currentController = controller;\r\n                currentController.path = args.path;\r\n                currentController.name = args.name;\r\n                currentController.description = args.description;\r\n                currentController.security = args.security;\r\n                currentController.deprecated = args.deprecated;\r\n            }\r\n        }\r\n        this.controllerMap[target.name] = _.mergeWith(\r\n            this.controllerMap[target.name],\r\n            currentController\r\n        );\r\n    }\r\n\r\n    public addOperationGet(\r\n        args: IApiOperationGetArgs,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): void {\r\n        assert.ok(args, 'Args are required.');\r\n        assert.ok(args.responses, 'Responses are required.');\r\n        if (args.parameters) {\r\n            assert.ok(!args.parameters.body, 'Parameter body is not required.');\r\n        }\r\n        this.addOperation('get', args, target, propertyKey);\r\n    }\r\n\r\n    public addOperationPost(\r\n        args: IApiOperationPostArgs,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): void {\r\n        assert.ok(args, 'Args are required.');\r\n        assert.ok(args.parameters, 'Parameters are required.');\r\n        assert.ok(args.responses, 'Responses are required.');\r\n        this.addOperation('post', args, target, propertyKey);\r\n    }\r\n\r\n    public addOperationPut(\r\n        args: IApiOperationPostArgs,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): void {\r\n        assert.ok(args, 'Args are required.');\r\n        assert.ok(args.parameters, 'Parameters are required.');\r\n        assert.ok(args.responses, 'Responses are required.');\r\n        this.addOperation('put', args, target, propertyKey);\r\n    }\r\n\r\n    public addOperationPatch(\r\n        args: IApiOperationPostArgs,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): void {\r\n        assert.ok(args, 'Args are required.');\r\n        assert.ok(args.parameters, 'Parameters are required.');\r\n        assert.ok(args.responses, 'Responses are required.');\r\n        this.addOperation('patch', args, target, propertyKey);\r\n    }\r\n\r\n    public addOperationDelete(\r\n        args: IApiOperationPostArgs,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): void {\r\n        assert.ok(args, 'Args are required.');\r\n        assert.ok(args.parameters, 'Parameters are required.');\r\n        assert.ok(!args.parameters.body, 'Parameter body is not required.');\r\n        assert.ok(args.responses, 'Responses are required.');\r\n        this.addOperation('delete', args, target, propertyKey);\r\n    }\r\n\r\n    public addSecurityDefinitions(securityDefinitions: {\r\n        [key: string]: ISwaggerSecurityDefinition;\r\n    }): void {\r\n        this.data.securityDefinitions = securityDefinitions;\r\n    }\r\n\r\n    public buildSwagger(): void {\r\n        const data: ISwagger = _.cloneDeep(this.data);\r\n        for (const controllerIndex in this.controllerMap) {\r\n            const controller: IController = this.controllerMap[controllerIndex];\r\n            if (_.toArray(controller.paths).length > 0) {\r\n                for (const pathIndex in controller.paths) {\r\n                    const path: IPath = controller.paths[pathIndex];\r\n                    const swaggerPath: ISwaggerPath = {};\r\n                    if (path.get) {\r\n                        swaggerPath.get = this.buildSwaggerOperation(\r\n                            path.get,\r\n                            controller\r\n                        );\r\n                    }\r\n                    if (path.post) {\r\n                        swaggerPath.post = this.buildSwaggerOperation(\r\n                            path.post,\r\n                            controller\r\n                        );\r\n                    }\r\n                    if (path.put) {\r\n                        swaggerPath.put = this.buildSwaggerOperation(\r\n                            path.put,\r\n                            controller\r\n                        );\r\n                    }\r\n                    if (path.patch) {\r\n                        swaggerPath.patch = this.buildSwaggerOperation(\r\n                            path.patch,\r\n                            controller\r\n                        );\r\n                    }\r\n                    if (path.delete) {\r\n                        swaggerPath.delete = this.buildSwaggerOperation(\r\n                            path.delete,\r\n                            controller\r\n                        );\r\n                    }\r\n                    if (path.path && path.path.length > 0) {\r\n                        data.paths[\r\n                            controller.path.concat(path.path)\r\n                        ] = swaggerPath;\r\n                    } else {\r\n                        data.paths[controller.path] = swaggerPath;\r\n                    }\r\n                }\r\n            } else {\r\n                const swaggerPath: ISwaggerPath = {};\r\n                data.paths[controller.path] = swaggerPath;\r\n            }\r\n\r\n            if (!_.find(data.tags, (tag: ISwaggerTag) => tag.name === _.upperFirst(controller.name))) {\r\n              data.tags.push({\r\n                  name: _.upperFirst(controller.name),\r\n                  description: controller.description,\r\n              } as ISwaggerTag);\r\n            }\r\n        }\r\n        this.data = data;\r\n    }\r\n\r\n    public addApiModelProperty(\r\n        args: IApiModelPropertyArgs,\r\n        target: any,\r\n        propertyKey: string | symbol,\r\n        propertyType: string\r\n    ) {\r\n        const definitionKey = target.constructor.name;\r\n        let swaggerBuildDefinitionModel: ISwaggerBuildDefinitionModel = this\r\n            .modelsMap[definitionKey];\r\n        if (!swaggerBuildDefinitionModel) {\r\n            swaggerBuildDefinitionModel = {\r\n                properties: {},\r\n            };\r\n            this.modelsMap[definitionKey] = swaggerBuildDefinitionModel;\r\n        }\r\n\r\n        const swaggerBuildDefinitionModelProperty: ISwaggerBuildDefinitionModelProperty = {\r\n            type: _.lowerCase(propertyType),\r\n        };\r\n        if (args) {\r\n            swaggerBuildDefinitionModelProperty.required = args.required;\r\n            swaggerBuildDefinitionModelProperty.description = args.description;\r\n            swaggerBuildDefinitionModelProperty.enum = args.enum;\r\n            swaggerBuildDefinitionModelProperty.itemType = args.itemType;\r\n            swaggerBuildDefinitionModelProperty.example = args.example;\r\n            swaggerBuildDefinitionModelProperty.format = args.format;\r\n            if (args.model) {\r\n                swaggerBuildDefinitionModelProperty.model = args.model;\r\n                if (!_.isEqual('Array', propertyType)) {\r\n                    swaggerBuildDefinitionModelProperty.type = undefined;\r\n                }\r\n            }\r\n            if (args.type) {\r\n                swaggerBuildDefinitionModelProperty.type = args.type;\r\n            }\r\n        }\r\n        swaggerBuildDefinitionModel.properties[\r\n            propertyKey.toString()\r\n        ] = swaggerBuildDefinitionModelProperty;\r\n        this.setDefinitions(this.modelsMap);\r\n    }\r\n\r\n    public addApiModel(args: IApiModelArgs, target: any): any {\r\n        const definitionKey = target.name;\r\n        let swaggerBuildDefinitionModel: ISwaggerBuildDefinitionModel = this\r\n            .modelsMap[definitionKey];\r\n        if (!swaggerBuildDefinitionModel) {\r\n            swaggerBuildDefinitionModel = {\r\n                properties: {},\r\n            };\r\n            this.modelsMap[definitionKey] = swaggerBuildDefinitionModel;\r\n        }\r\n        if (args) {\r\n            swaggerBuildDefinitionModel.description = args.description;\r\n            if (args.name) {\r\n                const name: string = _.upperFirst(args.name);\r\n                this.modelsMap[name] = _.cloneDeep(\r\n                    this.modelsMap[definitionKey]\r\n                );\r\n                if (!_.isEqual(name, definitionKey)) {\r\n                    delete this.modelsMap[definitionKey];\r\n                    delete this.data.definitions[definitionKey];\r\n                }\r\n            }\r\n        }\r\n        this.setDefinitions(this.modelsMap);\r\n    }\r\n\r\n    private initData(): void {\r\n        this.data = {\r\n            basePath: '/',\r\n            info: {\r\n                title: '',\r\n                version: '',\r\n            } as ISwaggerInfo,\r\n            paths: {},\r\n            tags: [],\r\n            schemes: [SwaggerDefinitionConstant.Scheme.HTTP],\r\n            produces: [SwaggerDefinitionConstant.Produce.JSON],\r\n            consumes: [SwaggerDefinitionConstant.Consume.JSON],\r\n            definitions: {},\r\n            swagger: '2.0',\r\n        };\r\n    }\r\n\r\n    private addOperation(\r\n        operation: string,\r\n        args: IApiOperationArgsBase,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): void {\r\n        let currentController: IController = {\r\n            paths: {},\r\n        };\r\n        for (const index in this.controllerMap) {\r\n            const controller = this.controllerMap[index];\r\n            if (index === target.constructor.name) {\r\n                currentController = controller;\r\n            }\r\n        }\r\n\r\n        let currentPath: IPath;\r\n        if (args.path && args.path.length > 0) {\r\n            if (!currentController.paths[args.path]) {\r\n                currentController.paths[args.path] = {} as IPath;\r\n            }\r\n            currentPath = currentController.paths[args.path];\r\n            currentPath.path = args.path;\r\n        } else {\r\n            if (!currentController.paths['/']) {\r\n                currentController.paths['/'] = {} as IPath;\r\n            }\r\n            currentPath = currentController.paths['/'];\r\n        }\r\n\r\n        if ('get' === operation) {\r\n            currentPath.get = this.buildOperation(args, target, propertyKey);\r\n        }\r\n\r\n        if ('post' === operation) {\r\n            currentPath.post = this.buildOperation(args, target, propertyKey);\r\n        }\r\n\r\n        if ('put' === operation) {\r\n            currentPath.put = this.buildOperation(args, target, propertyKey);\r\n        }\r\n\r\n        if ('patch' === operation) {\r\n            currentPath.patch = this.buildOperation(args, target, propertyKey);\r\n        }\r\n\r\n        if ('delete' === operation) {\r\n            currentPath.delete = this.buildOperation(args, target, propertyKey);\r\n        }\r\n\r\n        this.controllerMap[target.constructor.name] = currentController;\r\n    }\r\n\r\n    private buildOperation(\r\n        args: IApiOperationArgsBase,\r\n        target: any,\r\n        propertyKey: string | symbol\r\n    ): ISwaggerOperation {\r\n        const operation: ISwaggerOperation = {\r\n            operationId: propertyKey,\r\n            tags: [],\r\n        };\r\n        if (args.description) {\r\n            operation.description = args.description;\r\n        }\r\n        if (args.summary) {\r\n            operation.summary = args.summary;\r\n        }\r\n        if (args.produces && args.produces.length > 0) {\r\n            operation.produces = args.produces;\r\n        }\r\n\r\n        if (args.consumes && args.consumes.length > 0) {\r\n            operation.consumes = args.consumes;\r\n        }\r\n\r\n        if (args.tags && args.tags.length > 0) {\r\n            operation.tags = args.tags;\r\n        }\r\n\r\n        if (args.deprecated) {\r\n            operation.deprecated = args.deprecated;\r\n        }\r\n\r\n        if (args.parameters) {\r\n            operation.parameters = [];\r\n            if (args.parameters.header) {\r\n                operation.parameters = _.concat(\r\n                    operation.parameters,\r\n                    this.buildParameters(\r\n                        SwaggerDefinitionConstant.Parameter.In.HEADER,\r\n                        args.parameters.header\r\n                    )\r\n                );\r\n            }\r\n            if (args.parameters.path) {\r\n                operation.parameters = _.concat(\r\n                    operation.parameters,\r\n                    this.buildParameters(\r\n                        SwaggerDefinitionConstant.Parameter.In.PATH,\r\n                        args.parameters.path\r\n                    )\r\n                );\r\n            }\r\n            if (args.parameters.query) {\r\n                operation.parameters = _.concat(\r\n                    operation.parameters,\r\n                    this.buildParameters(\r\n                        SwaggerDefinitionConstant.Parameter.In.QUERY,\r\n                        args.parameters.query\r\n                    )\r\n                );\r\n            }\r\n            if (args.parameters.body) {\r\n                operation.parameters = _.concat(\r\n                    operation.parameters,\r\n                    this.buildBodyOperationParameter(args.parameters.body)\r\n                );\r\n            }\r\n            if (args.parameters.formData) {\r\n                operation.parameters = _.concat(\r\n                    operation.parameters,\r\n                    this.buildParameters(\r\n                        SwaggerDefinitionConstant.Parameter.In.FORM_DATA,\r\n                        args.parameters.formData\r\n                    )\r\n                );\r\n            }\r\n        }\r\n\r\n        if (args.responses) {\r\n            operation.responses = this.buildOperationResponses(args.responses);\r\n        }\r\n\r\n        if (args.security) {\r\n            operation.security = this.buildOperationSecurity(args.security);\r\n        }\r\n\r\n        return operation;\r\n    }\r\n\r\n    private buildOperationResponses(responses: {\r\n        [key: string]: IApiOperationArgsBaseResponse;\r\n    }): {\r\n        [key: string]: ISwaggerOperationResponse;\r\n    } {\r\n        const swaggerOperationResponses: {\r\n            [key: string]: ISwaggerOperationResponse;\r\n        } = {};\r\n        for (const responseIndex in responses) {\r\n            const response: IApiOperationArgsBaseResponse =\r\n                responses[responseIndex];\r\n            const newSwaggerOperationResponse: ISwaggerOperationResponse = {};\r\n            if (response.description) {\r\n                newSwaggerOperationResponse.description = response.description;\r\n            } else {\r\n                switch (responseIndex) {\r\n                    case '200':\r\n                        newSwaggerOperationResponse.description = 'Success';\r\n                        break;\r\n                    case '201':\r\n                        newSwaggerOperationResponse.description = 'Created';\r\n                        break;\r\n                    case '202':\r\n                        newSwaggerOperationResponse.description = 'Accepted';\r\n                        break;\r\n                    case '203':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Non-Authoritative Information';\r\n                        break;\r\n                    case '204':\r\n                        newSwaggerOperationResponse.description = 'No Content';\r\n                        break;\r\n                    case '205':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Reset Content';\r\n                        break;\r\n                    case '206':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Partial Content';\r\n                        break;\r\n                    case '400':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Client error and Bad Request';\r\n                        break;\r\n                    case '401':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Client error and Unauthorized';\r\n                        break;\r\n                    case '404':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Client error and Not Found';\r\n                        break;\r\n                    case '406':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Client error and Not Acceptable';\r\n                        break;\r\n                    case '500':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Internal Server Error';\r\n                        break;\r\n                    case '501':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Not Implemented';\r\n                        break;\r\n                    case '503':\r\n                        newSwaggerOperationResponse.description =\r\n                            'Service Unavailable';\r\n                        break;\r\n                    default:\r\n                        newSwaggerOperationResponse.description = null;\r\n                }\r\n            }\r\n            if (response.model) {\r\n                const ref = this.buildRef(response.model);\r\n                let newSwaggerOperationResponseSchema: ISwaggerOperationSchema = {\r\n                    $ref: ref,\r\n                };\r\n                if (\r\n                    _.isEqual(\r\n                        response.type,\r\n                        SwaggerDefinitionConstant.Response.Type.ARRAY\r\n                    )\r\n                ) {\r\n                    newSwaggerOperationResponseSchema = {\r\n                        items: {\r\n                            $ref: ref,\r\n                        } as ISwaggerOperationSchemaItems,\r\n                        type: SwaggerDefinitionConstant.Response.Type.ARRAY,\r\n                    };\r\n                }\r\n                newSwaggerOperationResponse.schema = newSwaggerOperationResponseSchema;\r\n            }\r\n            swaggerOperationResponses[\r\n                responseIndex\r\n            ] = newSwaggerOperationResponse;\r\n        }\r\n        return swaggerOperationResponses;\r\n    }\r\n\r\n    private buildBodyOperationParameter(\r\n        bodyOperationArgsBaseParameter: IApiBodyOperationArgsBaseParameter\r\n    ): ISwaggerOperationParameter[] {\r\n        const swaggerOperationParameterList: ISwaggerOperationParameter[] = [];\r\n        const swaggerOperationParameter = {} as ISwaggerOperationParameter;\r\n        swaggerOperationParameter.name = bodyOperationArgsBaseParameter.name\r\n            ? bodyOperationArgsBaseParameter.name\r\n            : 'body';\r\n        swaggerOperationParameter.in = 'body';\r\n        swaggerOperationParameter.type = bodyOperationArgsBaseParameter.type;\r\n        swaggerOperationParameter.description =\r\n            bodyOperationArgsBaseParameter.description;\r\n        swaggerOperationParameter.required =\r\n            bodyOperationArgsBaseParameter.required;\r\n        swaggerOperationParameter.format =\r\n            bodyOperationArgsBaseParameter.format;\r\n        swaggerOperationParameter.deprecated =\r\n            bodyOperationArgsBaseParameter.deprecated;\r\n        swaggerOperationParameter.allowEmptyValue =\r\n            bodyOperationArgsBaseParameter.allowEmptyValue;\r\n        swaggerOperationParameter.minimum =\r\n            bodyOperationArgsBaseParameter.minimum;\r\n        swaggerOperationParameter.maximum =\r\n            bodyOperationArgsBaseParameter.maximum;\r\n        swaggerOperationParameter.default =\r\n            bodyOperationArgsBaseParameter.default;\r\n        let schema = {} as ISwaggerOperationSchema;\r\n        if (bodyOperationArgsBaseParameter.properties) {\r\n            schema.type = 'object';\r\n            schema.required = [];\r\n            schema.properties = {} as {\r\n                [key: string]: ISwaggerPropertySchemaOperation;\r\n            };\r\n            for (const propetyIndex in bodyOperationArgsBaseParameter.properties) {\r\n                const propertyBodyOperationArgsBaseParameter =\r\n                    bodyOperationArgsBaseParameter.properties[propetyIndex];\r\n                const propertySchemaOperation = {} as ISwaggerPropertySchemaOperation;\r\n                propertySchemaOperation.type =\r\n                    propertyBodyOperationArgsBaseParameter.type;\r\n                schema.properties[propetyIndex] = propertySchemaOperation;\r\n                if (propertyBodyOperationArgsBaseParameter.required) {\r\n                    schema.required.push(propetyIndex);\r\n                }\r\n            }\r\n        }\r\n        if (bodyOperationArgsBaseParameter.model) {\r\n            const swaggerOperationSchema: ISwaggerOperationSchema = {\r\n                $ref: this.buildRef(bodyOperationArgsBaseParameter.model),\r\n            };\r\n\r\n            if (bodyOperationArgsBaseParameter.type !== 'array') {\r\n                schema = swaggerOperationSchema;\r\n            } else {\r\n                schema.type = bodyOperationArgsBaseParameter.type;\r\n                schema.items = {\r\n                    $ref: this.buildRef(bodyOperationArgsBaseParameter.model),\r\n                };\r\n            }\r\n        }\r\n        swaggerOperationParameter.schema = schema;\r\n        swaggerOperationParameterList.push(swaggerOperationParameter);\r\n        return swaggerOperationParameterList;\r\n    }\r\n\r\n    private buildOperationSecurity(argsSecurity: {\r\n        [key: string]: any[];\r\n    }): { [key: string]: any[] }[] {\r\n        const securityToReturn = [];\r\n        for (const securityIndex in argsSecurity) {\r\n            const security: any[] = argsSecurity[securityIndex];\r\n            const result: { [key: string]: any[] } = {};\r\n            result[securityIndex] = security;\r\n            securityToReturn.push(result);\r\n        }\r\n        return securityToReturn;\r\n    }\r\n\r\n    private buildParameters(\r\n        type: string,\r\n        parameters: { [key: string]: IApiOperationArgsBaseParameter }\r\n    ): ISwaggerOperationParameter[] {\r\n        const swaggerOperationParameter: ISwaggerOperationParameter[] = [];\r\n        for (const parameterIndex in parameters) {\r\n            const parameter: IApiOperationArgsBaseParameter =\r\n                parameters[parameterIndex];\r\n            const newSwaggerOperationParameter: ISwaggerOperationParameter = {\r\n                name: parameterIndex,\r\n                in: type,\r\n                type: parameter.type,\r\n                items: parameter.items\r\n            };\r\n            if (parameter.name) {\r\n                newSwaggerOperationParameter.name = parameter.name;\r\n            }\r\n            newSwaggerOperationParameter.description = parameter.description;\r\n            newSwaggerOperationParameter.required = parameter.required;\r\n            newSwaggerOperationParameter.format = parameter.format;\r\n            newSwaggerOperationParameter.deprecated = parameter.deprecated;\r\n            newSwaggerOperationParameter.allowEmptyValue =\r\n                parameter.allowEmptyValue;\r\n            newSwaggerOperationParameter.minimum = parameter.minimum;\r\n            newSwaggerOperationParameter.maximum = parameter.maximum;\r\n            newSwaggerOperationParameter.default = parameter.default;\r\n            swaggerOperationParameter.push(newSwaggerOperationParameter);\r\n        }\r\n        return swaggerOperationParameter;\r\n    }\r\n\r\n    private buildSwaggerOperation(\r\n        operation: ISwaggerOperation,\r\n        controller: IController\r\n    ): ISwaggerOperation {\r\n        if (_.isUndefined(operation.produces)) {\r\n            operation.produces = this.data.produces;\r\n        }\r\n        if (_.isUndefined(operation.consumes)) {\r\n            operation.consumes = this.data.consumes;\r\n        }\r\n        if (_.isUndefined(operation.security) && controller.security) {\r\n            operation.security = this.buildOperationSecurity(\r\n                controller.security\r\n            );\r\n        }\r\n        if (_.isUndefined(operation.deprecated) && controller.deprecated) {\r\n            operation.deprecated = controller.deprecated;\r\n        }\r\n        if (this.globalResponses) {\r\n            operation.responses = _.mergeWith(\r\n                _.cloneDeep(this.globalResponses),\r\n                operation.responses\r\n            );\r\n        }\r\n        if (operation.tags && operation.tags.length > 0) {\r\n            operation.tags.unshift(_.upperFirst(controller.name));\r\n        } else {\r\n            operation.tags = [_.upperFirst(controller.name)];\r\n        }\r\n        return operation;\r\n    }\r\n\r\n    private buildRef(definition: string): string {\r\n        return '#/definitions/'.concat(_.upperFirst(definition));\r\n    }\r\n}\r\n"]}